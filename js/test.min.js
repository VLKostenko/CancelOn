!function(t,i){t.createComponentClass("base.results.Rail",{options:{pinnable:!0,sticky:!1,debug:!1,debounceDelay:5,handleHorizontalScroll:!0,repositionTimeout:200},prevScroll:0,upScroll:!1,stickTop:!1,stickBottom:!1,originalNode:null,staticPosition:0,pinnedContentHeight:0,enabled:!0,init:function(){this.options.pinnable&&i(document).ready(this.setWidth.bind(this))},addEventHandlers:function(){},inlineComponentsReady:function(){var t=this;t.originalNode=t.element.get(0),this.bindWindowEvents(),this.options.pinnable&&this.subscribe("resultspage.streaming.done moreFilters.toggle filterTab.changed filter.overflow.toggle displayad.loaded textad.loaded pinnedContent.heightChanged".split(" "),function(){t.onScroll()}),this.subscribe("resultspage.view.setvisible",function(i){i&&t.setWidth()}),this.subscribe("pinnedContent.enable",function(i){t.enabled=i}),this.subscribe("pinnedContent.reset",function(){t.resetPosition()})},setWidth:function(){var t=this;setTimeout(function(){t.element.css("width",t.element.parent().width())},0)},onScroll:function(){!1!==this.enabled&&(this.isRailAttached()?this.handleScroll():this.unbindWindowEvents())},handleScroll:function(){this.setPinnedContentHeight();var t=this.getWindowScroll(),i=this.getParentScroll();this.upScroll=this.prevScroll>t,this.prevScroll=t,(t=this.getPositionCSS(t,i,this.isElementTallerThanScreen()))&&this.element.css(t)},unbindWindowEvents:function(){i(window).off("scroll.pinrails-"+this.id()),i(window).off("resize.pinrails-"+this.id())},bindWindowEvents:function(){var e;this.options.pinnable&&(0<this.options.repositionTimeout&&this.element.css("transition","transform %sms ease-in-out".format(this.options.repositionTimeout)),e=0<this.options.debounceDelay?t.Common.Utils.debounce(this.onScroll.bind(this),this.options.debounceDelay):this.onScroll.bind(this),i(window).on("scroll.pinrails-"+this.id(),e),i(window).on("resize.pinrails-"+this.id(),e))},testBottom:function(t,i){return i?t<this.getParentHeight()-this.getWindowHeight():t+this.getElementHeight()<this.getParentHeight()},testTop:function(t,i){return t>this.getParentTop()-this.pinnedContentHeight},isElementTallerThanScreen:function(){return this.getElementHeight()>this.getWindowHeight()},calculateScrollPosition:function(t,i){return i?(this.upScroll&&t<=this.getElementTop()-this.getParentTop()?(this.stickTop=!0,this.stickBottom=!1):!this.upScroll&&t+this.getWindowHeight()>=this.getElementBottom()-this.getParentTop()?(this.stickTop=!1,this.stickBottom=!0):this.stickBottom=this.stickTop=!1,this.stickBottom?{position:"bottom"}:this.stickTop?{position:"top"}:{translate:this.staticPosition}):{position:"top"}},resetPosition:function(){var t=i.extend(!0,{},{position:"relative",top:"auto",bottom:"auto"},this.makeTransformCSS("translate(0,0)"));this.element.css(t)},getPositionCSS:function(t,e,n){if(!this.isRailSticky()){var o=0,s={position:"relative",top:"auto",bottom:"auto"};t=this.testTop(t,n);var r=this.testBottom(e,n);return this.staticPosition=this.getElementTop()-this.getParentTop(),t&&r?(e=this.calculateScrollPosition(e,n),e.translate&&(o=e.translate),e.position?"top"==e.position?(s={position:"fixed",top:0,bottom:"auto"},o=this.pinnedContentHeight):(s={position:"fixed",bottom:0,top:"auto"},o=0):s=i.extend({},s)):(o=t?this.getParentHeight()-this.getElementHeight():0,s=i.extend({},s)),e="translateY(%spx)".format(o),this.options.handleHorizontalScroll&&"fixed"===s.position&&(n=this.getLeftScroll(),0<n&&(e="translate(-%spx, %spx)".format(n,o))),i.extend({},s,this.makeTransformCSS(e))}},makeTransformCSS:function(t){return{msTransform:t,transform:t}},destroy:function(){this.unbindWindowEvents(),this.base()},isRailAttached:function(){return this.element&&i.contains(window.document,this.originalNode)},isRailSticky:function(){var t=this.element.css("position");return"sticky"===t||"-webkit-sticky"===t},getElementHeight:function(){return Math.round(this.element.outerHeight())},getElementBottom:function(){return this.getElementTop()+this.getElementHeight()},getElementTop:function(){return Math.round(this.element.offset().top)},getWindowHeight:function(){return Math.round(i(window).outerHeight())},getWindowScroll:function(){return Math.round(i(window).scrollTop())},getParentHeight:function(){return Math.round(this.element.parent().outerHeight())},getParentTop:function(){return Math.round(this.element.parent().offset().top)},getLeftScroll:function(){return Math.round(i(window).scrollLeft())},getParentBottom:function(){return this.getParentTop()+this.getParentHeight()},getParentScroll:function(){return this.getWindowScroll()-this.getParentTop()},setPinnedContentHeight:function(){var i=t.question.ask("pinnedContent.height");null!==i?this.pinnedContentHeight=i:0!==this.pinnedContentHeight&&(this.pinnedContentHeight=0)}})}(R9,jQuery);